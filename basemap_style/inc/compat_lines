include 'inc/roadspeed';

name=* { name '${name}' }
mkgmap:default_name=* { name '${mkgmap:default_name}' }
mkgmap:display_name=* { addlabel '${mkgmap:display_name|subst:;=>/}' }

mkgmap:label:1!=* & ref=* { addlabel '${ref|part:;:1}' }
mkgmap:label:1!=* & int_ref=* { addlabel '${int_ref|part:;:1}' }
mkgmap:label:1!=* & nat_ref=* { addlabel '${nat_ref|part:;:1}' }
mkgmap:label:1!=* & reg_ref=* { addlabel '${reg_ref|part:;:1}' }

ref=*     { addlabel '${ref|part:;:1}';     addlabel '${ref|part:;:2}';     addlabel '${ref|part:;:3}'     }
int_ref=* { addlabel '${int_ref|part:;:1}'; addlabel '${int_ref|part:;:2}'; addlabel '${int_ref|part:;:3}' }
nat_ref=* { addlabel '${nat_ref|part:;:1}'; addlabel '${nat_ref|part:;:2}'; addlabel '${nat_ref|part:;:3}' }
reg_ref=* { addlabel '${reg_ref|part:;:1}'; addlabel '${reg_ref|part:;:2}'; addlabel '${reg_ref|part:;:3}' }

highway=* & mkgmap:label:1=* & mkgmap:street!=* { add mkgmap:street='${mkgmap:label:1}' }

toll=* { set mkgmap:toll='${toll}' }

# mkgmap:carpool tag is set but before new access handling was introduced it had a
# different meaning. Copy it to keep its value which is handled in the old behaviour last.
mkgmap:carpool=* { set mkgmap:carpool_compat='${mkgmap:carpool}'; delete mkgmap:carpool }

access=private | access=no { setaccess no; set mkgmap:carpool=yes; }
access=yes | access=permissive | access=official | access=designated { setaccess yes; set mkgmap:carpool=no; }
access=destination { set mkgmap:throughroute=no }

bicycle=private | bicycle=no { set mkgmap:bicycle=no; }
bicycle=yes | bicycle=permissive | bicycle=official | bicycle=designated { set mkgmap:bicycle=yes; }

carpool=private | carpool=no { set mkgmap:carpool=no; }
carpool=yes | carpool=permissive | carpool=official | carpool=designated { set mkgmap:carpool=yes; }

foot=private | foot=no { set mkgmap:foot=no; }
foot=yes | foot=permissive | foot=official | foot=designated { set mkgmap:foot=yes; }

hgv=private | hgv=no { set mkgmap:truck=no; }
hgv=yes | hgv=permissive | hgv=official | hgv=designated { set mkgmap:truck=yes; }

motorcar=private | motorcar=no { set mkgmap:car=no; }
motorcar=yes | motorcar=permissive | motorcar=official | motorcar=designated { set mkgmap:car=yes; }
motorcar=destination { set mkgmap:throughroute=no }

motorcycle=private | motorcycle=no { set mkgmap:car=no; }
motorcycle=yes | motorcycle=permissive | motorcycle=official | motorcycle=designated { set mkgmap:car=yes; }
motorcycle=destination { set mkgmap:throughroute=no }

psv=private | psv=no { set mkgmap:bus=no; }
psv=yes | psv=permissive | psv=official | psv=designated { set mkgmap:bus=yes; }

taxi=private | taxi=no { set mkgmap:taxi=no; }
taxi=yes | taxi=permissive | taxi=official | taxi=designated { set mkgmap:taxi=yes; }

emergency=private | emergency=no { set mkgmap:emergency=no; }
emergency=yes | emergency=permissive | emergency=official | emergency=designated { set mkgmap:emergency=yes; }

delivery=private | delivery=no { set mkgmap:delivery=no; }
delivery=yes | delivery=permissive | delivery=official | delivery=designated { set mkgmap:delivery=yes; }

goods=private | goods=no { set mkgmap:delivery=no; }
goods=yes | goods=permissive | goods=official | goods=designated { set mkgmap:delivery=yes; }

# Reintroduce the old carpool handling which allows access only for bus and emergency plus setting the carpool bit
mkgmap:carpool_compat=yes  { setaccess=no; set mkgmap:bus=yes; set mkgmap:emergency=yes; set mkgmap:carpool=yes }

